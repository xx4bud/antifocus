// ==============================
// MEDIAS
// ==============================

model Media {
  id             String @id @default(uuid())
  organizationId String

  provider MediaProvider @default(other)
  key      String?
  path     String?

  fileType MediaFileType @default(other)
  mimeType String
  name     String
  url      String
  width    Int
  height   Int
  size     Int
  dpi      Int?
  metadata Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organization         Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  productMedias        ProductMedia[]
  productVariantMedias ProductVariantMedia[]
  orderItemMedias      OrderItemMedia[]

  @@index([organizationId])
  @@index([provider])
  @@index([fileType])
  @@index([mimeType])
  @@map("medias")
}

// ==============================
// PRODUCT MEDIAS
// ==============================

model ProductMedia {
  id        String @id @default(uuid())
  productId String
  mediaId   String

  isMain   Boolean @default(false)
  position Int     @default(0)

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  media   Media   @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([productId, mediaId])
  @@index([productId])
  @@index([mediaId])
  @@map("product_medias")
}

// ==============================
// PRODUCT VARIANT MEDIAS
// ==============================

model ProductVariantMedia {
  id        String @id @default(uuid())
  variantId String
  mediaId   String

  isMain   Boolean @default(false)
  position Int     @default(0)

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  media   Media          @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([variantId, mediaId])
  @@index([variantId])
  @@index([mediaId])
  @@map("product_variant_medias")
}

// ==============================
// ORDER ITEM MEDIAS
// ==============================

model OrderItemMedia {
  id          String @id @default(uuid())
  orderItemId String
  mediaId     String

  isMain   Boolean @default(false)
  position Int     @default(0)

  orderItem OrderItem @relation(fields: [orderItemId], references: [id], onDelete: Cascade)
  media     Media     @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([orderItemId, mediaId])
  @@index([orderItemId])
  @@index([mediaId])
  @@map("order_item_medias")
}
