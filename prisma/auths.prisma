// ==============================
// USER ROLES
// ==============================

model UserRole {
  id         String @id @default(uuid())
  role       String @unique
  permission Json
  metadata   Json?

  isSystem Boolean @default(false) // system_role
  enabled  Boolean @default(true)
  position Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
  @@index([enabled])
  @@map("user_roles")
}

// ==============================
// BETTER-AUTH USERS
// ==============================

model User {
  id            String  @id @default(uuid())
  name          String
  email         String  @unique
  emailVerified Boolean @default(false)
  image         String? // avatar

  // username plugin
  username        String? @unique // slug
  displayUsername String?

  // phone number plugin
  phoneNumber         String? @unique
  phoneNumberVerified Boolean @default(false)

  // admin plugin
  role       String    @default("user")
  banned     Boolean   @default(false)
  banReason  String?
  banExpires DateTime?

  // 2fa plugin
  twoFactorEnabled Boolean @default(false)

  status   UserStatus @default(pending)
  settings Json? // preferences
  metadata Json?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  sessions    Session[]
  accounts    Account[]
  members     Member[]
  invitations Invitation[]
  customers   Customer[]

  @@index([email])
  @@index([username])
  @@index([phoneNumber])
  @@index([name])
  @@index([role])
  @@index([status, banned])
  @@map("users")
}

// ==============================
// BETTER-AUTH SESSIONS
// ==============================

model Session {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime

  ipAddress String?
  userAgent String?
  metadata  Json?

  // admin plugin
  impersonatedBy String? // user_id

  // organization plugin
  activeOrganizationId String? // organization_id

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([impersonatedBy])
  @@index([activeOrganizationId])
  @@map("sessions")
}

// ==============================
// BETTER-AUTH ACCOUNTS
// ==============================

model Account {
  id         String @id @default(uuid())
  providerId String // google, etc
  accountId  String
  userId     String
  metadata   Json?

  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?

  // credential provider
  scope    String
  password String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([providerId])
  @@index([accountId])
  @@index([userId])
  @@map("accounts")
}

// ==============================
// BETTER-AUTH VARIATIONS
// ==============================

model Verification {
  id         String   @id @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  metadata   Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([identifier])
  @@map("verifications")
}

// ==============================
// ACTIVITY LOGS
// ==============================

model ActivityLog {
  id    String  @id @default(uuid())
  type  String  @default("system")
  actor String?

  entity String
  action String

  changes  Json?
  metadata Json?

  createdAt DateTime @default(now())

  @@index([type])
  @@index([actor])
  @@index([entity])
  @@index([action])
  @@map("activity_logs")
}
