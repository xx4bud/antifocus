// ==============================
// BETTER-AUTH USERS
// ==============================

model User {
  id            String  @id @default(uuid())
  name          String
  email         String  @unique
  emailVerified Boolean @default(false)
  image         String? // avatar

  // username plugin
  username        String? @unique // slug
  displayUsername String?

  // phone number plugin
  phoneNumber         String? @unique
  phoneNumberVerified Boolean @default(false)

  // admin plugin
  role       String    @default("user")
  banned     Boolean   @default(false)
  banReason  String?
  banExpires DateTime?

  // 2fa plugin
  twoFactorEnabled Boolean @default(false)

  // additionals
  status   UserStatus @default(pending)
  settings Json? // preferences
  metadata Json?

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // soft delete
  deletedAt DateTime?

  sessions     Session[]
  accounts     Account[]
  members      Member[]
  invitations  Invitation[]
  twoFactors   TwoFactor[]
  apiKeys      ApiKey[]
  activityLogs ActivityLog[]

  @@index([email])
  @@index([username])
  @@index([phoneNumber])
  @@index([name])
  @@index([role])
  @@index([status, banned])
  @@map("users")
}

// ==============================
// BETTER-AUTH SESSIONS
// ==============================

model Session {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime

  ipAddress String?
  userAgent String?

  // admin plugin
  impersonatedBy String? // user_id = super_admin

  // organization plugin
  activeOrganizationId String? // organization_id

  // additionals
  metadata Json?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([impersonatedBy])
  @@index([activeOrganizationId])
  @@map("sessions")
}

// ==============================
// BETTER-AUTH ACCOUNTS
// ==============================

model Account {
  id         String @id @default(uuid())
  userId     String
  providerId String // google, credential, etc
  accountId  String

  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?

  // credentials
  scope    String?
  password String? // hashed

  // additionals
  metadata Json?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([providerId, accountId])
  @@index([userId])
  @@map("accounts")
}

// ==============================
// BETTER-AUTH VERIFICATIONS
// ==============================

model Verification {
  id         String   @id @default(uuid())
  identifier String // email, phone_number, etc
  value      String
  expiresAt  DateTime

  // additionals
  metadata Json?

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([identifier])
  @@map("verifications")
}

// ==============================
// BETTER-AUTH TWO FACTORS
// ==============================

model TwoFactor {
  id          String @id @default(uuid())
  userId      String
  secret      String
  backupCodes String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([secret])
  @@map("two_factors")
}

// ==============================
// BETTER-AUTH API KEYS
// ==============================

model ApiKey {
  id     String @id @default(uuid())
  userId String

  name   String?
  start  String?
  prefix String?
  key    String

  refillInterval Int?
  refillAmount   Int?
  lastRefillAt   DateTime?

  enabled          Boolean @default(true)
  rateLimitEnabled Boolean @default(true)

  rateLimitTimeWindow Int       @default(86400000)
  rateLimitMax        Int       @default(10)
  requestCount        Int       @default(0)
  remaining           Int?
  lastRequest         DateTime?
  expiresAt           DateTime?

  metadata    String?
  permissions String?

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([key])
  @@index([enabled])
  @@index([rateLimitEnabled])
  @@map("api_keys")
}

// ==============================
// USER ROLES
// ==============================

model UserRole {
  id         String @id @default(uuid())
  role       String
  permission Json

  // additionals
  isSystem Boolean @default(false) // system_role
  enabled  Boolean @default(true)
  position Int?

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
  @@index([enabled])
  @@map("user_roles")
}
