// ==============================
// CATEGORIES
// ==============================

model Category {
  id             String  @id @default(uuid())
  organizationId String?

  name  String
  slug  String  @unique
  image String?

  parentId String?

  enabled  Boolean @default(true)
  position Int     @default(0)

  attributes Json?
  metadata   Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)

  parent            Category?         @relation("category_tree", fields: [parentId], references: [id], onDelete: SetNull)
  children          Category[]        @relation("category_tree")
  productCategories ProductCategory[]

  @@index([organizationId])
  @@index([slug])
  @@index([parentId])
  @@index([enabled])
  @@map("categories")
}

// ==============================
// PRODUCT CATEGORIES
// ==============================

model ProductCategory {
  id         String @id @default(uuid())
  categoryId String
  productId  String

  isPrimary Boolean @default(false)
  enabled   Boolean @default(true)
  position  Int     @default(0)

  metadata Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([categoryId, productId])
  @@index([categoryId])
  @@index([productId])
  @@map("product_categories")
}
